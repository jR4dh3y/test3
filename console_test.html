<!DOCTYPE html>
<html>
<head>
    <title>WASM Test - Console Output</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #status { font-size: 18px; margin-bottom: 20px; }
        #output { background: #f0f0f0; padding: 10px; white-space: pre-wrap; font-family: monospace; }
    </style>
</head>
<body>
    <h1>WASM Test</h1>
    <div id="status">Loading...</div>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        const status = document.getElementById('status');
        
        function log(message) {
            console.log(message);
            output.textContent += message + '\n';
        }
        
        let Module = {
            onRuntimeInitialized: function() {
                log('✓ WASM Runtime initialized successfully!');
                status.textContent = 'WASM loaded successfully!';
                
                try {
                    // Test basic functions
                    if (typeof Module._initGame === 'function') {
                        log('✓ initGame function found');
                        Module._initGame();
                        log('✓ Game initialized');
                        
                        // Test getting initial values
                        log('Player initial position:');
                        log('  X: ' + Module._getPlayerX());
                        log('  Y: ' + Module._getPlayerY());
                        log('  Z: ' + Module._getPlayerZ());
                        
                        log('Car initial position:');
                        log('  X: ' + Module._getCarX());
                        log('  Y: ' + Module._getCarY());
                        log('  Z: ' + Module._getCarZ());
                        
                        log('Initial game state:');
                        log('  Score: ' + Module._getScore());
                        log('  In Car: ' + (Module._getInCar() ? 'Yes' : 'No'));
                        log('  Enemies: ' + Module._getEnemyCount());
                        log('  Bullets: ' + Module._getBulletCount());
                        
                        // Test updating game
                        log('\\nTesting game update...');
                        Module._updateGame();
                        log('✓ Game update successful');
                        
                        // Test input
                        log('\\nTesting input...');
                        Module._setKey(119, 1); // 'w' key
                        Module._updateGame();
                        log('After pressing W:');
                        log('  Player X: ' + Module._getPlayerX());
                        log('  Player Z: ' + Module._getPlayerZ());
                        
                        status.textContent = 'WASM test completed successfully!';
                        log('\\n✓ All tests passed! WASM is working correctly.');
                        
                    } else {
                        throw new Error('initGame function not found');
                    }
                } catch (error) {
                    log('✗ Error: ' + error.message);
                    status.textContent = 'Error: ' + error.message;
                }
            },
            onAbort: function(what) {
                log('✗ WASM aborted: ' + what);
                status.textContent = 'WASM loading failed: ' + what;
            },
            print: function(text) {
                log('WASM: ' + text);
            },
            printErr: function(text) {
                log('WASM Error: ' + text);
            }
        };
        
        log('About to load WASM...');
        
        // Check after timeout
        setTimeout(() => {
            if (status.textContent === 'Loading...') {
                log('✗ WASM loading timeout');
                status.textContent = 'WASM loading timeout';
            }
        }, 5000);
    </script>
    <script async src="game.js"></script>
</body>
</html>
